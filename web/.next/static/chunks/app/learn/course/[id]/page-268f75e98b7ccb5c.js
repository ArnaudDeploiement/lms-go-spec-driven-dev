(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[77],{9319:function(e,t,r){Promise.resolve().then(r.bind(r,3677))},3677:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Z}});var n=r(7437),s=r(2265),i=r(521),a=r(8614),l=r(9376),o=r(515),d=r(3405),c=r(2869),u=r(6070),h=r(9205);let m=(0,h.Z)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),f=(0,h.Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),x=(0,h.Z)("FileQuestion",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]),p=(0,h.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var g=r(1769),y=r(2660),v=r(6337),j=r(1671),b=r(1723);let N=(0,h.Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),w=e=>{let{progressValue:t,moduleProgress:r,totalModules:n}=e;if(r&&r.length>0){let e=r.filter(e=>"completed"===e.status).length,t=n&&n>0?n:r.length;if(t>0)return Math.round(e/t*100)}return"number"!=typeof t||Number.isNaN(t)?0:t<=1?Math.round(100*t):Math.round(t)},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;return{...e,module_progress:t,progress_pct:w({progressValue:e.progress,moduleProgress:t,totalModules:r})}},_={video:m,pdf:f,article:f,quiz:x,scorm:p};function Z(){let e=(0,l.useRouter)(),t=(0,l.useParams)(),{user:r,organization:h,isAuthenticated:m}=(0,o.a)(),[x,p]=(0,s.useState)(null),[Z,M]=(0,s.useState)(null),[C,E]=(0,s.useState)(!0),[z,R]=(0,s.useState)(!1),P=t.id;(0,s.useEffect)(()=>{if(!m){e.push("/auth");return}(async()=>{if(h)try{let e=await d.x.getCourse(h.id,P);p(e);try{let t=(await d.x.getEnrollments(h.id,r?{user_id:r.id}:{})).find(e=>e.course_id===P);if(t){let r=await d.x.getProgress(h.id,t.id),n=e&&"object"==typeof e&&Array.isArray(e.modules)?e.modules.length:(null==e?void 0:e.data)&&Array.isArray(e.data.modules)?e.data.modules.length:r.length;M(k(t,r,n))}}catch(e){console.error("Error fetching enrollment:",e)}}catch(e){console.error("Error fetching course:",e)}finally{E(!1)}})()},[m,h,r,P,e]);let S=async()=>{if(h&&r){R(!0);try{var e,t;let n=await d.x.createEnrollment(h.id,{course_id:P,user_id:r.id}),s=await d.x.getProgress(h.id,n.id);M(k(n,s,null!==(t=null==x?void 0:null===(e=x.modules)||void 0===e?void 0:e.length)&&void 0!==t?t:s.length))}catch(e){console.error("Error enrolling:",e)}finally{R(!1)}}},V=async t=>{var r;if(!Z||!h)return;let n=null===(r=Z.module_progress)||void 0===r?void 0:r.find(e=>e.module_id===t.id);if(!((null==n?void 0:n.status)==="not_started"&&t.order_index>0)){if(!n||"not_started"===n.status)try{await d.x.startModule(h.id,Z.id,t.id);let e=await d.x.getProgress(h.id,Z.id);M(t=>{var r,n;return t?{...t,module_progress:e,progress_pct:w({progressValue:t.progress,moduleProgress:e,totalModules:null!==(n=null==x?void 0:null===(r=x.modules)||void 0===r?void 0:r.length)&&void 0!==n?n:e.length})}:t})}catch(e){console.error("Error updating progress:",e)}e.push("/learn/course/".concat(P,"/module/").concat(t.id))}},A=e=>{var t;if(!Z)return"locked";let r=null===(t=Z.module_progress)||void 0===t?void 0:t.find(t=>t.module_id===e.id);return r?r.status:"not_started"};return C?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-blue-600"})}):x?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("header",{className:"border-b bg-white",children:(0,n.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,n.jsxs)(c.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/learn"),className:"mb-4",children:[(0,n.jsx)(y.Z,{className:"h-4 w-4 mr-2"}),"Retour au catalogue"]})})}),(0,n.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,n.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,n.jsxs)(u.Zb,{className:"mb-8",children:[(0,n.jsx)(u.Ol,{children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)(u.ll,{className:"text-3xl mb-2",children:x.title}),(0,n.jsx)(u.SZ,{className:"text-base",children:x.description})]}),(0,n.jsx)("div",{className:"ml-4",children:Z?(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Progression"}),(0,n.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[Z.progress_pct||0,"%"]})]}):(0,n.jsx)(c.z,{onClick:S,disabled:z,children:z?"Inscription...":"S'inscrire"})})]})}),Z&&(0,n.jsx)(u.aY,{children:(0,n.jsx)("div",{className:"h-2 w-full rounded-full bg-gray-200",children:(0,n.jsx)(i.E.div,{initial:{width:0},animate:{width:"".concat(Z.progress_pct||0,"%")},transition:{duration:.5,delay:.2},className:"h-full rounded-full bg-blue-600"})})})]})}),(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Modules de formation"}),x.modules&&0!==x.modules.length?(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)(a.M,{children:x.modules.sort((e,t)=>e.order_index-t.order_index).map((e,t)=>{let r=A(e),s="completed"===r,a="in_progress"===r,l=!Z||"not_started"===r&&t>0,o=_[e.module_type]||f;return(0,n.jsx)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3,delay:.05*t},children:(0,n.jsx)(u.Zb,{className:"\n                            transition-all cursor-pointer\n                            ".concat(l?"opacity-60":"hover:shadow-lg","\n                            ").concat(a?"border-blue-500 border-2":"","\n                            ").concat(s?"border-green-500":"","\n                          "),onClick:()=>!l&&V(e),children:(0,n.jsx)(u.Ol,{children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex items-start gap-4 flex-1",children:[(0,n.jsx)("div",{className:"\n                                  p-3 rounded-lg\n                                  ".concat(s?"bg-green-100":"bg-blue-100","\n                                "),children:l?(0,n.jsx)(v.Z,{className:"h-6 w-6 text-gray-400"}):s?(0,n.jsx)(j.Z,{className:"h-6 w-6 text-green-600"}):(0,n.jsx)(o,{className:"h-6 w-6 ".concat(a?"text-blue-600":"text-gray-600")})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)(u.ll,{className:"text-xl mb-1",children:["Module ",t+1,": ",e.title]}),(0,n.jsx)(u.SZ,{children:e.description}),(0,n.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[e.duration_minutes&&(0,n.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,n.jsx)(b.Z,{className:"h-4 w-4"}),e.duration_minutes," min"]}),(0,n.jsx)("span",{className:"text-sm text-gray-600 capitalize",children:e.module_type})]})]})]}),(0,n.jsx)("div",{children:l?(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Verrouill\xe9"}):s?(0,n.jsx)(j.Z,{className:"h-6 w-6 text-green-600"}):a?(0,n.jsx)(N,{className:"h-6 w-6 text-blue-600"}):(0,n.jsx)(c.z,{size:"sm",variant:"outline",children:"Commencer"})})]})})})},e.id)})})}):(0,n.jsx)(u.Zb,{children:(0,n.jsxs)(u.aY,{className:"flex flex-col items-center justify-center py-12",children:[(0,n.jsx)(g.Z,{className:"h-16 w-16 text-gray-400 mb-4"}),(0,n.jsx)("p",{className:"text-gray-600 text-center",children:"Aucun module disponible pour cette formation"})]})})]})]})]}):(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)(u.Zb,{children:(0,n.jsxs)(u.aY,{className:"flex flex-col items-center py-12",children:[(0,n.jsx)(g.Z,{className:"h-16 w-16 text-gray-400 mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Formation non trouv\xe9e"}),(0,n.jsx)(c.z,{className:"mt-4",onClick:()=>e.push("/learn"),children:"Retour au catalogue"})]})})})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var n=r(7437),s=r(2265),i=r(7495),a=r(535),l=r(4508);let o=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:a,asChild:d=!1,...c}=e,u=d?i.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(o({variant:s,size:a,className:r})),ref:t,...c})});d.displayName="Button"},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return a},aY:function(){return c},ll:function(){return o}});var n=r(7437),s=r(2265),i=r(4508);let a=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});a.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return i}});var n=r(1994),s=r(3335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}},1769:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]])},1671:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1723:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6337:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9205).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},8614:function(e,t,r){"use strict";r.d(t,{M:function(){return g}});var n=r(7437),s=r(2265),i=r(8881),a=r(3576),l=r(4252),o=r(5750);class d extends s.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function c(e){let{children:t,isPresent:r}=e,i=(0,s.useId)(),a=(0,s.useRef)(null),l=(0,s.useRef)({width:0,height:0,top:0,left:0}),{nonce:c}=(0,s.useContext)(o._);return(0,s.useInsertionEffect)(()=>{let{width:e,height:t,top:n,left:s}=l.current;if(r||!a.current||!e||!t)return;a.current.dataset.motionPopId=i;let o=document.createElement("style");return c&&(o.nonce=c),document.head.appendChild(o),o.sheet&&o.sheet.insertRule('\n          [data-motion-pop-id="'.concat(i,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(n,"px !important;\n            left: ").concat(s,"px !important;\n          }\n        ")),()=>{document.head.removeChild(o)}},[r]),(0,n.jsx)(d,{isPresent:r,childRef:a,sizeRef:l,children:s.cloneElement(t,{ref:a})})}let u=e=>{let{children:t,initial:r,isPresent:i,onExitComplete:o,custom:d,presenceAffectsLayout:u,mode:m}=e,f=(0,a.h)(h),x=(0,s.useId)(),p=(0,s.useCallback)(e=>{for(let t of(f.set(e,!0),f.values()))if(!t)return;o&&o()},[f,o]),g=(0,s.useMemo)(()=>({id:x,initial:r,isPresent:i,custom:d,onExitComplete:p,register:e=>(f.set(e,!1),()=>f.delete(e))}),u?[Math.random(),p]:[i,p]);return(0,s.useMemo)(()=>{f.forEach((e,t)=>f.set(t,!1))},[i]),s.useEffect(()=>{i||f.size||!o||o()},[i]),"popLayout"===m&&(t=(0,n.jsx)(c,{isPresent:i,children:t})),(0,n.jsx)(l.O.Provider,{value:g,children:t})};function h(){return new Map}var m=r(9637);let f=e=>e.key||"";function x(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}var p=r(1534);let g=e=>{let{children:t,custom:r,initial:l=!0,onExitComplete:o,presenceAffectsLayout:d=!0,mode:c="sync",propagate:h=!1}=e,[g,y]=(0,m.oO)(h),v=(0,s.useMemo)(()=>x(t),[t]),j=h&&!g?[]:v.map(f),b=(0,s.useRef)(!0),N=(0,s.useRef)(v),w=(0,a.h)(()=>new Map),[k,_]=(0,s.useState)(v),[Z,M]=(0,s.useState)(v);(0,p.L)(()=>{b.current=!1,N.current=v;for(let e=0;e<Z.length;e++){let t=f(Z[e]);j.includes(t)?w.delete(t):!0!==w.get(t)&&w.set(t,!1)}},[Z,j.length,j.join("-")]);let C=[];if(v!==k){let e=[...v];for(let t=0;t<Z.length;t++){let r=Z[t],n=f(r);j.includes(n)||(e.splice(t,0,r),C.push(r))}"wait"===c&&C.length&&(e=C),M(x(e)),_(v);return}let{forceRender:E}=(0,s.useContext)(i.p);return(0,n.jsx)(n.Fragment,{children:Z.map(e=>{let t=f(e),s=(!h||!!g)&&(v===Z||j.includes(t));return(0,n.jsx)(u,{isPresent:s,initial:(!b.current||!!l)&&void 0,custom:s?void 0:r,presenceAffectsLayout:d,mode:c,onExitComplete:s?void 0:()=>{if(!w.has(t))return;w.set(t,!0);let e=!0;w.forEach(t=>{t||(e=!1)}),e&&(null==E||E(),M(N.current),h&&(null==y||y()),o&&o())},children:e},t)})})}}},function(e){e.O(0,[777,148,515,971,117,744],function(){return e(e.s=9319)}),_N_E=e.O()}]);