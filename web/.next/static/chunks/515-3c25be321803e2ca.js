"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[515],{3405:function(e,t,r){r.d(t,{x:function(){return o}});class s{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(this.baseUrl).concat(e),s={...t,credentials:"include",headers:{"Content-Type":"application/json",...t.headers}};try{let t=await fetch(r,s);if(401===t.status&&!e.includes("/auth/")){await this.refreshToken();let e=await fetch(r,s);if(!e.ok)throw await this.handleError(e);return await e.json()}if(!t.ok)throw await this.handleError(t);if(204===t.status)return{};return await t.json()}catch(e){if(e instanceof Error&&"Failed to fetch"===e.message)throw{error:"Impossible de se connecter au serveur",status:0};throw e}}async handleError(e){try{return{error:(await e.json()).error||e.statusText,status:e.status}}catch(t){return{error:e.statusText||"Une erreur est survenue",status:e.status}}}async refreshToken(){return this.isRefreshing||(this.isRefreshing=!0,this.refreshPromise=(async()=>{try{await fetch("".concat(this.baseUrl,"/auth/refresh?use_cookies=true"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})}catch(e){throw window.location.href="/auth",e}finally{this.isRefreshing=!1,this.refreshPromise=null}})()),this.refreshPromise}async signup(e){return this.request("/auth/signup?use_cookies=true",{method:"POST",body:JSON.stringify(e)})}async login(e){return this.request("/auth/login?use_cookies=true",{method:"POST",body:JSON.stringify(e)})}async me(){return this.request("/auth/me")}async logout(){try{await fetch("".concat(this.baseUrl,"/auth/logout"),{method:"POST",credentials:"include"})}catch(e){}window.location.href="/auth"}async forgotPassword(e){return this.request("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:e})})}async listOrganizations(e){let t=e?"?status=".concat(encodeURIComponent(e)):"";return this.request("/orgs".concat(t))}async createOrganization(e){return this.request("/orgs",{method:"POST",body:JSON.stringify(e)})}async getOrganization(e){return this.request("/orgs/".concat(e))}async updateOrganization(e,t){return this.request("/orgs/".concat(e),{method:"PATCH",body:JSON.stringify(t)})}async archiveOrganization(e){await this.request("/orgs/".concat(e),{method:"DELETE"})}async activateOrganization(e){await this.request("/orgs/".concat(e,"/activate"),{method:"POST"})}async getCourses(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.status?"?status=".concat(encodeURIComponent(t.status)):"";return this.request("/courses".concat(r),{headers:{"X-Org-ID":e}})}async getCourse(e,t){return this.request("/courses/".concat(t),{headers:{"X-Org-ID":e}})}async createCourse(e,t){return this.request("/courses",{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(t)})}async updateCourse(e,t,r){return this.request("/courses/".concat(t),{method:"PATCH",headers:{"X-Org-ID":e},body:JSON.stringify(r)})}async publishCourse(e,t){await this.request("/courses/".concat(t,"/publish"),{method:"POST",headers:{"X-Org-ID":e}})}async unpublishCourse(e,t){await this.request("/courses/".concat(t,"/unpublish"),{method:"POST",headers:{"X-Org-ID":e}})}async archiveCourse(e,t){await this.request("/courses/".concat(t),{method:"DELETE",headers:{"X-Org-ID":e}})}async listModules(e,t){return this.request("/courses/".concat(t,"/modules"),{headers:{"X-Org-ID":e}})}async createModule(e,t,r){let s={title:r.title,module_type:r.module_type};return void 0!==r.content_id&&(s.content_id=r.content_id),void 0!==r.duration_seconds&&(s.duration_seconds=r.duration_seconds),void 0!==r.data&&(s.data=r.data),this.request("/courses/".concat(t,"/modules"),{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(s)})}async updateModule(e,t,r){let s={title:r.title,module_type:r.module_type};return void 0!==r.content_id&&(s.content_id=r.content_id),void 0!==r.duration_seconds&&(s.duration_seconds=r.duration_seconds),void 0!==r.data&&(s.data=r.data),this.request("/courses/modules/".concat(t),{method:"PATCH",headers:{"X-Org-ID":e},body:JSON.stringify(s)})}async deleteModule(e,t){await this.request("/courses/modules/".concat(t),{method:"DELETE",headers:{"X-Org-ID":e}})}async reorderModules(e,t,r){await this.request("/courses/".concat(t,"/modules/reorder"),{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify({module_ids:r})})}async getEnrollments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams;t.user_id&&r.set("user_id",t.user_id),t.course_id&&r.set("course_id",t.course_id),t.group_id&&r.set("group_id",t.group_id),t.status&&r.set("status",t.status);let s=r.toString()?"?".concat(r.toString()):"";return this.request("/enrollments".concat(s),{headers:{"X-Org-ID":e}})}async createEnrollment(e,t){return this.request("/enrollments",{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(t)})}async updateEnrollment(e,t,r){return this.request("/enrollments/".concat(t),{method:"PATCH",headers:{"X-Org-ID":e},body:JSON.stringify(r)})}async cancelEnrollment(e,t){await this.request("/enrollments/".concat(t),{method:"DELETE",headers:{"X-Org-ID":e}})}async listGroups(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams;t.course_id&&r.set("course_id",t.course_id);let s=r.toString()?"?".concat(r.toString()):"";return this.request("/enrollments/groups".concat(s),{headers:{"X-Org-ID":e}})}async createGroup(e,t){return this.request("/enrollments/groups",{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(t)})}async updateGroup(e,t,r){return this.request("/enrollments/groups/".concat(t),{method:"PATCH",headers:{"X-Org-ID":e},body:JSON.stringify(r)})}async deleteGroup(e,t){await this.request("/enrollments/groups/".concat(t),{method:"DELETE",headers:{"X-Org-ID":e}})}async listUsers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams;t.role&&r.set("role",t.role),t.status&&r.set("status",t.status);let s=r.toString()?"?".concat(r.toString()):"";return this.request("/users".concat(s),{headers:{"X-Org-ID":e}})}async createUser(e,t){return this.request("/users",{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(t)})}async getUser(e,t){return this.request("/users/".concat(t),{headers:{"X-Org-ID":e}})}async updateUser(e,t,r){return this.request("/users/".concat(t),{method:"PATCH",headers:{"X-Org-ID":e},body:JSON.stringify(r)})}async deactivateUser(e,t){await this.request("/users/".concat(t),{method:"DELETE",headers:{"X-Org-ID":e}})}async activateUser(e,t){await this.request("/users/".concat(t,"/activate"),{method:"POST",headers:{"X-Org-ID":e}})}async getProgress(e,t){return this.request("/enrollments/".concat(t,"/progress"),{headers:{"X-Org-ID":e}})}async startModule(e,t,r){return this.request("/enrollments/".concat(t,"/progress/start"),{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify({module_id:r})})}async completeModule(e,t,r,s){return this.request("/enrollments/".concat(t,"/progress/complete"),{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify({module_id:r,score:s})})}async listContents(e){return this.request("/contents",{headers:{"X-Org-ID":e}})}async createContent(e,t){return this.request("/contents",{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(t)})}async getContent(e,t){return this.request("/contents/".concat(t),{headers:{"X-Org-ID":e}})}async finalizeContent(e,t,r){return this.request("/contents/".concat(t,"/finalize"),{method:"POST",headers:{"X-Org-ID":e},body:JSON.stringify(r)})}async archiveContent(e,t){await this.request("/contents/".concat(t),{method:"DELETE",headers:{"X-Org-ID":e}})}async getDownloadLink(e,t){return this.request("/contents/".concat(t,"/download"),{headers:{"X-Org-ID":e}})}constructor(e="/api"){this.isRefreshing=!1,this.refreshPromise=null,this.baseUrl=e}}let o=new s},515:function(e,t,r){r.d(t,{AuthProvider:function(){return i},a:function(){return u}});var s=r(7437),o=r(2265),n=r(3405);let a=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,o.useState)(null),[u,c]=(0,o.useState)(null),[d,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("organization");e&&t&&(i(JSON.parse(e)),c(JSON.parse(t))),(async()=>{try{let e=await n.x.me(),t={id:e.user.id,email:e.user.email,role:e.user.role},r={id:e.organization.id,name:e.organization.name,slug:e.organization.slug};i(t),c(r),localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("organization",JSON.stringify(r))}catch(e){(null==e?void 0:e.status)!==401&&console.error("Profile fetch error:",e),i(null),c(null),localStorage.removeItem("user"),localStorage.removeItem("organization")}finally{h(!1)}})()},[]);let l=async e=>{try{let t=await n.x.signup(e),r={id:t.user.id,email:t.user.email,role:t.user.role},s={id:t.organization.id,name:t.organization.name,slug:t.organization.slug};i(r),c(s),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("organization",JSON.stringify(s))}catch(e){throw console.error("Signup error:",e),e}},g=async e=>{try{await n.x.login(e);let t=await n.x.me(),r={id:t.user.id,email:t.user.email,role:t.user.role},s={id:t.organization.id,name:t.organization.name,slug:t.organization.slug};i(r),c(s),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("organization",JSON.stringify(s))}catch(e){throw console.error("Login error:",e),e}},y=async()=>{await n.x.logout(),i(null),c(null),localStorage.removeItem("user"),localStorage.removeItem("organization")};return(0,s.jsx)(a.Provider,{value:{user:r,organization:u,isLoading:d,isAuthenticated:!!r,signup:l,login:g,logout:y},children:t})}function u(){let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);