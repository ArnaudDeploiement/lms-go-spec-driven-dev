{{define "admin"}}
  {{template "layout" .}}
{{end}}

{{define "content"}}
<div class="space-y-10">
  <!-- Quick navigation -->
  {{if ne .SelectedOrg.String "00000000-0000-0000-0000-000000000000"}}
  <section class="rounded-xl bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white">
    <h2 class="text-2xl font-bold">Tableau de bord Admin</h2>
    <p class="mt-1 text-blue-100">Gérez votre plateforme LMS</p>
    <div class="mt-6 grid gap-4 md:grid-cols-3">
      <a href="/admin/courses?org={{.SelectedOrg}}" class="rounded-lg bg-white/10 p-4 ring-1 ring-white/20 hover:bg-white/20 transition-colors">
        <div class="text-3xl mb-2">📚</div>
        <div class="font-semibold">Gestion des cours</div>
        <div class="mt-1 text-sm text-blue-100">Créer et gérer vos parcours pédagogiques</div>
      </a>
      <a href="/admin/contents?org={{.SelectedOrg}}" class="rounded-lg bg-white/10 p-4 ring-1 ring-white/20 hover:bg-white/20 transition-colors">
        <div class="text-3xl mb-2">📁</div>
        <div class="font-semibold">Bibliothèque de contenus</div>
        <div class="mt-1 text-sm text-blue-100">Gérer vos fichiers et médias</div>
      </a>
      <a href="#users" class="rounded-lg bg-white/10 p-4 ring-1 ring-white/20 hover:bg-white/20 transition-colors">
        <div class="text-3xl mb-2">👥</div>
        <div class="font-semibold">Utilisateurs</div>
        <div class="mt-1 text-sm text-blue-100">Gérer les apprenants et formateurs</div>
      </a>
    </div>
  </section>
  {{end}}

  <section class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200">
    <h2 class="text-lg font-semibold text-slate-900">Organisations</h2>
    <form class="mt-4 grid gap-4 md:grid-cols-3" method="post" action="/admin/organizations">
      <div class="col-span-1">
        <label class="block text-sm font-medium text-slate-700" for="org-name">Nom</label>
        <input id="org-name" class="mt-1 w-full rounded border border-slate-300 px-3 py-2" name="name" placeholder="Ex: Université Demo" required />
      </div>
      <div class="col-span-1">
        <label class="block text-sm font-medium text-slate-700" for="org-slug">Slug</label>
        <input id="org-slug" class="mt-1 w-full rounded border border-slate-300 px-3 py-2" name="slug" placeholder="universite-demo" />
        <p class="mt-1 text-xs text-slate-500">Laisser vide pour générer automatiquement depuis le nom.</p>
      </div>
      <div class="flex items-end">
        <button class="w-full rounded bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700" type="submit">Créer</button>
      </div>
    </form>
    <ul class="mt-4 space-y-2 text-sm text-slate-600">
      {{range .Organizations}}
      <li class="flex items-center justify-between rounded border border-slate-200 px-3 py-2">
        <span>{{.Name}} <span class="text-slate-400">({{.Slug}})</span></span>
        <a class="text-blue-600 hover:underline" href="/admin?org={{.ID}}">Gérer</a>
      </li>
      {{else}}
      <li>Aucune organisation pour le moment.</li>
      {{end}}
    </ul>
  </section>

  {{if ne .SelectedOrg.String "00000000-0000-0000-0000-000000000000"}}
  <section id="users" class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200">
    <h2 class="text-lg font-semibold text-slate-900">Utilisateurs (organisation sélectionnée)</h2>
    <form class="mt-4 grid gap-4 md:grid-cols-4" method="post" action="/admin/users">
      <input type="hidden" name="org_id" value="{{.SelectedOrg}}" />
      <div class="col-span-1">
        <label class="block text-sm font-medium text-slate-700" for="user-email">Email</label>
        <input id="user-email" class="mt-1 w-full rounded border border-slate-300 px-3 py-2" name="email" type="email" placeholder="personne@example.com" required />
      </div>
      <div class="col-span-1">
        <label class="block text-sm font-medium text-slate-700" for="user-password">Mot de passe</label>
        <input id="user-password" class="mt-1 w-full rounded border border-slate-300 px-3 py-2" name="password" type="password" placeholder="••••••••" required />
      </div>
      <div class="col-span-1">
        <label class="block text-sm font-medium text-slate-700" for="user-role">Rôle</label>
        <select id="user-role" class="mt-1 w-full rounded border border-slate-300 px-3 py-2" name="role">
          {{range .UserRoles}}
          <option value="{{.}}" {{if eq . "learner"}}selected{{end}}>{{.}}</option>
          {{end}}
        </select>
        <p class="mt-1 text-xs text-slate-500">admin, designer, tutor ou learner.</p>
      </div>
      <div class="flex items-end">
        <button class="w-full rounded bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700" type="submit">Ajouter</button>
      </div>
    </form>
    <ul class="mt-4 space-y-2 text-sm text-slate-600">
      {{range .Users}}
      <li class="rounded border border-slate-200 px-3 py-2">{{.Email}} — {{.Role}} ({{.Status}})</li>
      {{else}}
      <li>Aucun utilisateur pour cette organisation.</li>
      {{end}}
    </ul>
  </section>

  <!-- Quick stats -->
  <section class="grid gap-4 md:grid-cols-3">
    <div class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200">
      <h3 class="text-sm font-medium text-slate-600">Cours créés</h3>
      <p class="mt-2 text-3xl font-bold text-slate-900">{{len .Courses}}</p>
      <a href="/admin/courses?org={{.SelectedOrg}}" class="mt-3 inline-block text-sm text-blue-600 hover:underline">Gérer les cours →</a>
    </div>
    <div class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200">
      <h3 class="text-sm font-medium text-slate-600">Fichiers médias</h3>
      <p class="mt-2 text-3xl font-bold text-slate-900">{{len .Contents}}</p>
      <a href="/admin/contents?org={{.SelectedOrg}}" class="mt-3 inline-block text-sm text-blue-600 hover:underline">Gérer les contenus →</a>
    </div>
    <div class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200">
      <h3 class="text-sm font-medium text-slate-600">Utilisateurs actifs</h3>
      <p class="mt-2 text-3xl font-bold text-slate-900">{{len .Users}}</p>
      <a href="#users" class="mt-3 inline-block text-sm text-blue-600 hover:underline">Gérer les utilisateurs →</a>
    </div>
  </section>
  {{end}}
</div>
{{end}}
