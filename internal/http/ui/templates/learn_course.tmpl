{{define "learn_course"}}
  {{template "layout" .}}
{{end}}

{{define "content"}}
<div class="space-y-8">
  <a class="inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-slate-800" href="/learn?org={{.OrganizationID}}{{if ne .LearnerID.String "00000000-0000-0000-0000-000000000000"}}&user={{.LearnerID}}{{end}}">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path d="m15 18-6-6 6-6" />
    </svg>
    Retour au catalogue
  </a>

  <header class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div>
        <p class="text-sm uppercase tracking-wide text-slate-500">Parcours</p>
        <h1 class="text-2xl font-semibold text-slate-900">{{.Course.Title}}</h1>
        <p class="mt-2 text-sm text-slate-600">{{.Course.Description}}</p>
      </div>
      {{if .Enrollment}}
      <div class="rounded-xl bg-slate-50 px-5 py-4 text-sm text-slate-600 ring-1 ring-slate-200">
        <p class="font-semibold text-slate-500">Progression</p>
        <p class="mt-1 text-lg font-semibold text-slate-900">{{printf "%.0f" .Enrollment.Progress}}%</p>
        <p class="mt-1 text-xs uppercase tracking-wide text-slate-500">{{.Enrollment.Status}}</p>
      </div>
      {{end}}
    </div>
    {{if .LearnerName}}
    <p class="mt-4 text-sm text-slate-500">Affiché pour : <span class="font-semibold text-slate-700">{{.LearnerName}}</span></p>
    {{end}}
  </header>

  <section class="grid gap-6 lg:grid-cols-3">
    <aside class="space-y-4 rounded-2xl bg-white p-5 shadow-slate-900/5 ring-1 ring-slate-200 lg:col-span-1">
      <h2 class="text-sm font-semibold uppercase tracking-wide text-slate-500">Modules</h2>
      <ol class="space-y-3">
        {{range .Modules}}
        <li>
          <a
            class="flex flex-col rounded-xl border px-4 py-3 text-sm transition hover:border-indigo-300 hover:bg-indigo-50 {{if and $.SelectedModule (eq $.SelectedModule.Module.ID .Module.ID)}}border-indigo-500 bg-indigo-50{{else}}border-slate-200 bg-white{{end}}"
            href="/learn/courses/{{$.Course.ID}}?org={{$.OrganizationID}}{{if ne $.LearnerID.String "00000000-0000-0000-0000-000000000000"}}&user={{$.LearnerID}}{{end}}&module={{.Module.ID}}">
            <span class="font-semibold text-slate-900">{{printf "%02d" .Module.Position}} — {{.Module.Title}}</span>
            <span class="mt-1 text-xs uppercase tracking-wide text-slate-500">
              {{.Module.ModuleType}} •
              {{if eq .Status "completed"}}Terminé{{else if eq .Status "in_progress"}}En cours{{else}}À faire{{end}}
            </span>
          </a>
        </li>
        {{end}}
      </ol>
    </aside>

    <article class="rounded-2xl bg-white p-6 shadow-xl shadow-slate-900/5 ring-1 ring-slate-200 lg:col-span-2">
      {{if and .SelectedModule .Content}}
      <header class="border-b border-slate-200 pb-4">
        <p class="text-xs uppercase tracking-wide text-slate-500">{{.Content.Type}}</p>
        <h2 class="mt-2 text-xl font-semibold text-slate-900">{{.Content.Title}}</h2>
        <p class="mt-2 text-sm text-slate-600">{{.Content.Description}}</p>
        {{if .Content.Duration}}
        <p class="mt-1 text-xs text-slate-500">{{.Content.Duration}} secondes</p>
        {{end}}
      </header>

      <div class="mt-6 space-y-6 text-sm text-slate-700">
        {{if .Content.DownloadURL}}
        <div class="rounded-lg bg-slate-50 p-4 ring-1 ring-slate-200">
          <p class="font-medium text-slate-700">Document</p>
          <p class="mt-1 text-xs text-slate-500">Lien de téléchargement temporaire.</p>
          <a class="mt-3 inline-flex items-center gap-2 rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700" href="{{.Content.DownloadURL}}" target="_blank" rel="noreferrer">
            Télécharger
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4 4h16v16H4z" />
              <path d="m8 12 4 4 4-4" />
              <path d="M12 8v8" />
            </svg>
          </a>
        </div>
        {{end}}

        {{if .Content.VideoURL}}
        <div class="aspect-video overflow-hidden rounded-xl ring-1 ring-slate-200">
          <iframe src="{{.Content.VideoURL}}" class="h-full w-full" allowfullscreen title="Vidéo du module"></iframe>
        </div>
        {{end}}

        {{if .Content.ArticleBody}}
        <div class="prose prose-slate max-w-none">
          <pre class="whitespace-pre-wrap font-sans text-sm text-slate-700">{{.Content.ArticleBody}}</pre>
        </div>
        {{end}}

        {{if and (not .Content.DownloadURL) (not .Content.VideoURL) (not .Content.ArticleBody)}}
        <p class="text-sm text-slate-500">Le contenu de ce module sera disponible prochainement.</p>
        {{end}}
      </div>
      {{else}}
      <p class="text-sm text-slate-600">Sélectionnez un module pour consulter son contenu.</p>
      {{end}}
    </article>
  </section>
</div>
{{end}}
